<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Getting started with the Databricks Labs Data Generator &mdash; Databricks Labs Data Generator 0.3.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/tdg.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Installation notes" href="installation_notes.html" />
    <link rel="prev" title="Databricks Labs Data Generator documentation" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Databricks Labs Data Generator
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Get Started Here</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general-overview">General Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tutorials-and-examples">Tutorials and examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="#basic-concepts">Basic concepts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#generating-the-test-data">Generating the test data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#getting-started">Getting started</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#creating-simple-test-data-sets">Creating simple test data sets</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#create-a-data-set-without-pre-existing-schemas">Create a data set without pre-existing schemas</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-data-set-with-pre-existing-schema">Creating data set with pre-existing schema</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#adding-dataspecs-to-match-multiple-columns">Adding dataspecs to match multiple columns</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-more-complex-example-building-device-iot-test-data">A more complex example - building Device IOT Test Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#scaling-it-up">Scaling it up</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-sql-in-data-generation">Using SQL in data generation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#generating-repeatable-data">Generating repeatable data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-generated-data-from-sql">Using generated data from SQL</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation_notes.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="generating_column_data.html">Generating column data</a></li>
<li class="toctree-l1"><a class="reference internal" href="DATARANGES.html">Using data ranges</a></li>
<li class="toctree-l1"><a class="reference internal" href="textdata.html">Generating text data</a></li>
<li class="toctree-l1"><a class="reference internal" href="DISTRIBUTIONS.html">Using data distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="options_and_features.html">Options for column specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="repeatable_data_generation.html">Repeatable data generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="repeatable_data_generation.html#revisiting-the-iot-data-example">Revisiting the IOT data example</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_streaming_data.html">Using streaming data</a></li>
<li class="toctree-l1"><a class="reference internal" href="generating_json_data.html">Generating JSON and structured column data</a></li>
<li class="toctree-l1"><a class="reference internal" href="generating_cdc_data.html">Generating Change Data Capture (CDC) data</a></li>
<li class="toctree-l1"><a class="reference internal" href="multi_table_data.html">Using multiple tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="extending_text_generation.html">Extending text generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting data generation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="relnotes/quickindex.html">Quick API index</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference/api/modules.html">The dbldatagen package API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="relnotes/CONTRIBUTING.html">Contributing to the Databricks Labs Data Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="relnotes/CONTRIBUTING.html#building-the-code">Building the code</a></li>
<li class="toctree-l1"><a class="reference internal" href="relnotes/CONTRIBUTING.html#testing">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="relnotes/CONTRIBUTING.html#using-the-databricks-labs-data-generator">Using the Databricks Labs data generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="relnotes/CONTRIBUTING.html#coding-style">Coding Style</a></li>
<li class="toctree-l1"><a class="reference internal" href="relnotes/CHANGELOG.html">Change log</a></li>
<li class="toctree-l1"><a class="reference internal" href="relnotes/requirements.html">Build requirements</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">License</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Databricks Labs Data Generator</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Getting started with the Databricks Labs Data Generator</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/APIDOCS.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="getting-started-with-the-databricks-labs-data-generator">
<h1>Getting started with the Databricks Labs Data Generator<a class="headerlink" href="#getting-started-with-the-databricks-labs-data-generator" title="Permalink to this heading"></a></h1>
<p>The Databricks Labs data generator (aka <code class="docutils literal notranslate"><span class="pre">dbldatagen</span></code>) is a Spark based solution for generating
realistic synthetic data. It uses the features of Spark dataframes and Spark SQL
to generate synthetic data. As the process produces a Spark dataframe populated
with generated data, it may be saved to storage in a variety of formats, saved to tables
or generally manipulated using the existing Spark Dataframe APIs.</p>
<p>It can also be used as a source in a Delta Live Tables pipeline supporting both streamimg and batch operation.</p>
<p>It has no dependencies on any libraries that are not already included in the Databricks
runtime, and you can use it from Scala, R or other languages by defining
a view over the generated data.</p>
<p>As the data generator is a Spark process, it can scale to generating data with millions or billions of rows
in minutes with reasonable sized clusters.</p>
<p>For example, at the time of writing, a billion row version of the IOT data set example listed later in the document
can be generated and written to a Delta table in
<a class="reference external" href="#scaling-it-up">under 2 minutes using a 12 node x 8 core cluster (using DBR 8.3)</a></p>
<blockquote>
<div><p>NOTE: The markup version of this document does not cover all of the classes and methods in the codebase and some links
may not work. To see the documentation for the latest release, see the online documentation.</p>
</div></blockquote>
<section id="general-overview">
<h2>General Overview<a class="headerlink" href="#general-overview" title="Permalink to this heading"></a></h2>
<p>The Databricks Labs Data Generator is a Python Library that can be used in several different ways:</p>
<ol class="simple">
<li><p>Generate a synthetic data set <a class="reference external" href="#create-a-data-set-without-pre-existing-schemas">without defining a schema in advance</a></p></li>
<li><p>Generate a synthetic data set <a class="reference external" href="#creating-data-set-with-pre-existing-schema">for an existing Spark SQL schema.</a></p></li>
<li><p>Generate a synthetic data set adding columns according to specifiers provided</p></li>
<li><p>Start with an existing schema and add columns along with specifications as to how values are generated</p></li>
</ol>
<p>The data generator includes the following features:</p>
<ul class="simple">
<li><p>Specify <a class="reference external" href="#create-a-data-set-without-pre-existing-schemas">number of rows to generate</a></p></li>
<li><p>Specify <a class="reference external" href="#scaling-it-up">number of Spark partitions to distribute data generation across</a></p></li>
<li><p>Specify <a class="reference internal" href="DATARANGES.html"><span class="doc">numeric, time and date ranges for columns</span></a></p></li>
<li><p>Generate column data at <a class="reference external" href="#generating-repeatable-data">random or from repeatable seed values</a></p></li>
<li><p>Generate column data from <a class="reference external" href="#generating-repeatable-data">one or more seed columns</a><br /><a class="reference external" href="#create-a-data-set-without-pre-existing-schemas">values optionally with weighting</a> of how frequently values occur</p></li>
<li><p>Use <a class="reference external" href="#creating-data-set-with-pre-existing-schema">template based text generation</a>
and <a class="reference internal" href="textdata.html"><span class="doc">formatting on string columns</span></a></p></li>
<li><p>Use <a class="reference external" href="#using-sql-in-data-generation">SQL based expressions</a> to control or augment column generation</p></li>
<li><p>Script Spark SQL table creation statement for dataset</p></li>
<li><p>Specify a <a class="reference internal" href="DISTRIBUTIONS.html"><span class="doc">statistical distribution for random values</span></a></p></li>
<li><p>Support for use within Databricks Delta Live Tables pipelines</p></li>
</ul>
</section>
<section id="tutorials-and-examples">
<h2>Tutorials and examples<a class="headerlink" href="#tutorials-and-examples" title="Permalink to this heading"></a></h2>
<p>In the
<a class="reference external" href="https://github.com/databrickslabs/dbldatagen/tree/release/v0.2.1">Github project directory</a> ,
there are a number of examples and tutorials.</p>
<p>The Python examples in the <code class="docutils literal notranslate"><span class="pre">examples</span></code> folder can be run directly or imported into the Databricks runtime environment
as Python files.</p>
<p>The examples in the <code class="docutils literal notranslate"><span class="pre">tutorials</span></code> folder are in Databricks notebook export format and are intended to be imported
into the Databricks workspace environment.</p>
</section>
<section id="basic-concepts">
<h2>Basic concepts<a class="headerlink" href="#basic-concepts" title="Permalink to this heading"></a></h2>
<p>The Databricks Labs Data Generator is a Python framework that uses Spark to generate a dataframe of synthetic data.</p>
<p>Once the data frame is generated, it can be used with any Spark dataframe compatible API to save or persist data,
to analyze data, to write it to an external database or stream, or used in the same manner as a regular
PySpark dataframe.</p>
<p>To consume it from Scala, R, SQL or other languages, create a view over the resulting test dataframe and you can use
it from any Databricks Spark runtime compatible language. By use of the appropriate parameters,
you can instruct the data generator to automatically register a view as part of generating the test data.</p>
<section id="generating-the-test-data">
<h3>Generating the test data<a class="headerlink" href="#generating-the-test-data" title="Permalink to this heading"></a></h3>
<p>The data generation process is controlled by a data generation spec which can build a schema implicitly,
or a schema can be added from an existing table or Spark SQL schema object.</p>
<p>Each column to be generated derives its generated data from a set of one or more seed values.
By default, this is the <code class="docutils literal notranslate"><span class="pre">id</span></code> field of the base data frame
(generated with <code class="docutils literal notranslate"><span class="pre">spark.range</span></code> for batch data frames, or using a <code class="docutils literal notranslate"><span class="pre">Rate</span></code> source for streaming data frames).</p>
<p>Each column  can be specified as based on the <code class="docutils literal notranslate"><span class="pre">id</span></code> field or other columns in the test data generation spec.
Columns may be based on the value of on or more base fields, or on a <code class="docutils literal notranslate"><span class="pre">hash</span></code> of the base values.</p>
<p>Column base values may also be generated at random.</p>
<p>All further data generation on a particular column is controlled by a series of transformations on this base value,
typically one of :</p>
<ul class="simple">
<li><p>Mapping the base value to one of a set of discrete values, optionally with the use of weighting</p></li>
<li><p>Arithmetic transformation of the base value</p></li>
<li><p>Adding string formatting to the base value</p></li>
</ul>
<p>There is also support for applying arbitrary SQL expressions, and generation of common data from templates</p>
</section>
<section id="getting-started">
<h3>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this heading"></a></h3>
<p>Before using the data generator, you need to install the package in your environment and import it in your code.
You can install the package from PyPi as a library on your cluster.</p>
<blockquote>
<div><p>NOTE: When running in a Databricks notebook environment, you can install directly using
the <code class="docutils literal notranslate"><span class="pre">%pip</span></code> command in a notebook cell</p>
<p>To install as a notebook scoped library, add a cell with the following text and execute it:</p>
<p><code class="docutils literal notranslate"><span class="pre">%pip</span> <span class="pre">install</span> <span class="pre">dbldatagen</span></code></p>
</div></blockquote>
<p>The <code class="docutils literal notranslate"><span class="pre">%pip</span> <span class="pre">install</span></code> method will work in the Databricks Community Environment and in Delta Live Tables pipelines also.</p>
<p>You can find more details and alternative installation methods at <a class="reference internal" href="installation_notes.html"><span class="doc">Installation notes</span></a></p>
<p>The Github based releases are located at
<a class="reference external" href="https://github.com/databrickslabs/dbldatagen/releases">Databricks Labs Data Generator releases</a></p>
<p>Once installed, import the framework in your Python code to use it.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dbldatagen</span> <span class="k">as</span> <span class="nn">dg</span>
</pre></div>
</div>
<p>Creating the data set is performed by creating a definition for your dataset via the <code class="docutils literal notranslate"><span class="pre">DataGenerator</span></code> instance, which
specifies the rules that control data generation.</p>
<p>Once the <code class="docutils literal notranslate"><span class="pre">DataGenerator</span></code> specification is created, you use the <code class="docutils literal notranslate"><span class="pre">build</span></code> method to generate a Spark dataframe for the
data</p>
</section>
</section>
<section id="creating-simple-test-data-sets">
<h2>Creating simple test data sets<a class="headerlink" href="#creating-simple-test-data-sets" title="Permalink to this heading"></a></h2>
<p>You can use the data generator with, or without the use of a pre-existing schema.
The basic mechanism is as follows:</p>
<ul class="simple">
<li><p>Define a <code class="docutils literal notranslate"><span class="pre">DataGenerator</span></code> instance</p></li>
<li><p>Optionally add a schema</p></li>
<li><p>If using a schema, add specifications for how the columns are to be generated with the
<code class="docutils literal notranslate"><span class="pre">withColumnSpec</span></code> method. This does not add new columns, but specifies how columns imported from the
schema should be generated</p></li>
<li><p>Add new columns with the <code class="docutils literal notranslate"><span class="pre">withColumn</span></code> method</p></li>
</ul>
<blockquote>
<div><p><strong><em>NOTE:</em></strong> Column names are case insensitive in Spark SQL.
Hence adding a new column that has the same column name but differs in case from an existing column
name will succeed but potentially cause errors later.</p>
<p>When adding a column spec for an existing column, it is not necessary to define the type.</p>
</div></blockquote>
<section id="create-a-data-set-without-pre-existing-schemas">
<h3>Create a data set without pre-existing schemas<a class="headerlink" href="#create-a-data-set-without-pre-existing-schemas" title="Permalink to this heading"></a></h3>
<p>Here is an example of creating a simple test data set without use of a schema.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dbldatagen</span> <span class="k">as</span> <span class="nn">dg</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">FloatType</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">,</span> <span class="n">StringType</span>

<span class="n">row_count</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">column_count</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">testDataSpec</span> <span class="o">=</span> <span class="p">(</span><span class="n">dg</span><span class="o">.</span><span class="n">DataGenerator</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;test_data_set1&quot;</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">row_count</span><span class="p">,</span>
                                  <span class="n">partitions</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">randomSeedMethod</span><span class="o">=</span><span class="s1">&#39;hash_fieldname&#39;</span><span class="p">,</span> 
                                  <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                   <span class="o">.</span><span class="n">withIdOutput</span><span class="p">()</span>
                   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">FloatType</span><span class="p">(),</span> <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;floor(rand() * 350) * (86400 + 3600)&quot;</span><span class="p">,</span>
                                    <span class="n">numColumns</span><span class="o">=</span><span class="n">column_count</span><span class="p">)</span>
                   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;code1&quot;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="n">minValue</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">maxValue</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
                   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;code2&quot;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="n">minValue</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxValue</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;code3&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;online&#39;</span><span class="p">,</span> <span class="s1">&#39;offline&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">])</span>
                   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;code4&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                               <span class="n">percentNulls</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
                   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;code5&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                   <span class="p">)</span>

<span class="n">dfTestData</span> <span class="o">=</span> <span class="n">testDataSpec</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
<p>By default, the seed column for each row is the <code class="docutils literal notranslate"><span class="pre">id</span></code> column. Use of the method <code class="docutils literal notranslate"><span class="pre">withIdOutput()</span></code> retains the <code class="docutils literal notranslate"><span class="pre">id</span></code>
field in the output data. If this is not called, the <code class="docutils literal notranslate"><span class="pre">id</span></code> field is used during data generation, but it is dropped
from the final data output.</p>
<p>Each of the <code class="docutils literal notranslate"><span class="pre">withColumn</span></code> method calls introduces a new column (or columns).</p>
<p>The example above shows some common uses:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">withColumn</span></code> method call for the <code class="docutils literal notranslate"><span class="pre">r</span></code> column introduces multiple columns labelled <code class="docutils literal notranslate"><span class="pre">r1</span></code> to <code class="docutils literal notranslate"><span class="pre">rN</span></code> as determined by
the <code class="docutils literal notranslate"><span class="pre">numColumns</span></code> option. Here, we use the <code class="docutils literal notranslate"><span class="pre">expr</span></code> option to introduce a SQL expression to control the generation of the
column. Note this expression can refer to any preceding column including the <code class="docutils literal notranslate"><span class="pre">id</span></code> column.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">withColumn</span></code> method call for the <code class="docutils literal notranslate"><span class="pre">code1</span></code> column specifies the generation of values between 100 and 200
inclusive. These will be computed using modulo arithmetic on the <code class="docutils literal notranslate"><span class="pre">id</span></code> column.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">withColumn</span></code> method call for the <code class="docutils literal notranslate"><span class="pre">code2</span></code> column specifies the generation of values between 0 and 10
inclusive. These will be computed via a uniformly distributed random value.</p></li>
</ul>
<blockquote>
<div><p>By default all random values are uniformly distributed
unless either the <code class="docutils literal notranslate"><span class="pre">weights</span></code> option is used or a specific distribution is used.</p>
</div></blockquote>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">withColumn</span></code> method call for the <code class="docutils literal notranslate"><span class="pre">code3</span></code> column specifies the generation of string values from
the allowable values <code class="docutils literal notranslate"><span class="pre">['online',</span> <span class="pre">'offline',</span> <span class="pre">or</span> <span class="pre">'unknown']</span></code>
inclusive. These will be computed using modulo arithmetic on the <code class="docutils literal notranslate"><span class="pre">id</span></code> column and the resulting value mapped to the
set of allowable values</p></li>
</ul>
<blockquote>
<div><p>Specific value lists can be used with any data type fields - but user is responsible for ensuring the values are of
a compatible data type.</p>
</div></blockquote>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">withColumn</span></code> method call for the <code class="docutils literal notranslate"><span class="pre">code4</span></code> column specifies the generation of string values from
the allowable values <code class="docutils literal notranslate"><span class="pre">['a',</span> <span class="pre">'b',</span> <span class="pre">or</span> <span class="pre">'c']</span></code>
inclusive. But the <code class="docutils literal notranslate"><span class="pre">percentNulls</span></code> option gives a 5% chance of a null value being generated.
These will be computed via a uniformly distributed random value.</p></li>
</ul>
<blockquote>
<div><p>By default null values will not be generated for a field, unless the <code class="docutils literal notranslate"><span class="pre">percentNulls</span></code> option is specified</p>
</div></blockquote>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">withColumn</span></code> method call for the <code class="docutils literal notranslate"><span class="pre">code5</span></code> column specifies the generation of string values from
the allowable values <code class="docutils literal notranslate"><span class="pre">['a',</span> <span class="pre">'b',</span> <span class="pre">or</span> <span class="pre">'c']</span></code>
inclusive. These will be computed via a uniformly distributed random value but with weighting applied so that
the value <code class="docutils literal notranslate"><span class="pre">a</span></code> occurs 9 times as frequently as the values <code class="docutils literal notranslate"><span class="pre">b</span></code> or <code class="docutils literal notranslate"><span class="pre">c</span></code></p></li>
</ul>
<blockquote>
<div><p>NOTE: As the seed field named <code class="docutils literal notranslate"><span class="pre">id</span></code> is currently reserved for system use, manually adding a column named <code class="docutils literal notranslate"><span class="pre">id</span></code> can
interfere with the data generation. This will be fixed in a forthcoming release</p>
</div></blockquote>
</section>
<section id="creating-data-set-with-pre-existing-schema">
<h3>Creating data set with pre-existing schema<a class="headerlink" href="#creating-data-set-with-pre-existing-schema" title="Permalink to this heading"></a></h3>
<p>What if we want to generate data conforming to a pre-existing schema? you can specify a schema for your data by either
taking a schema from an existing table, or computing an explicit schema.</p>
<p>In this case you would use the <code class="docutils literal notranslate"><span class="pre">withColumnSpec</span></code> method instead of the <code class="docutils literal notranslate"><span class="pre">withColumn</span></code> method.</p>
<p>For fields imported from the schema, the schema controls the field name and data type, but the column specification
controls how the data is generated.</p>
<p>The following example illustrates use of a table schema to generate data for a table.
The schema can also be a schema from a view or a manually created schema</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dbldatagen</span> <span class="k">as</span> <span class="nn">dg</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">StructType</span><span class="p">,</span> <span class="n">StructField</span><span class="p">,</span>  <span class="n">StringType</span>

<span class="n">shuffle_partitions_requested</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">partitions_requested</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">data_rows</span> <span class="o">=</span> <span class="mi">10000000</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Create table if not exists test_vehicle_data(</span>
<span class="s2">                name string, </span>
<span class="s2">                serial_number string, </span>
<span class="s2">                license_plate string, </span>
<span class="s2">                email string</span>
<span class="s2">                ) using Delta&quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">table_schema</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s2">&quot;test_vehicle_data&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">schema</span>

<span class="nb">print</span><span class="p">(</span><span class="n">table_schema</span><span class="p">)</span>
  
<span class="n">dataspec</span> <span class="o">=</span> <span class="p">(</span><span class="n">dg</span><span class="o">.</span><span class="n">DataGenerator</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">10000000</span><span class="p">,</span> <span class="n">partitions</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> 
                  <span class="n">randomSeedMethod</span><span class="o">=</span><span class="s2">&quot;hash_fieldname&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withSchema</span><span class="p">(</span><span class="n">table_schema</span><span class="p">))</span>

<span class="n">dataspec</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataspec</span>
                <span class="o">.</span><span class="n">withColumnSpec</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">percentNulls</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">w </span><span class="se">\\</span><span class="s1">w|</span><span class="se">\\</span><span class="s1">w a. </span><span class="se">\\</span><span class="s1">w&#39;</span><span class="p">)</span>                                       
                <span class="o">.</span><span class="n">withColumnSpec</span><span class="p">(</span><span class="s2">&quot;serial_number&quot;</span><span class="p">,</span> <span class="n">minValue</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span> <span class="n">maxValue</span><span class="o">=</span><span class="mi">10000000</span><span class="p">,</span> 
                                 <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;dr&quot;</span><span class="p">,</span> <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
                <span class="o">.</span><span class="n">withColumnSpec</span><span class="p">(</span><span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">w.</span><span class="se">\\</span><span class="s1">w@</span><span class="se">\\</span><span class="s1">w.com&#39;</span><span class="p">)</span>       
                <span class="o">.</span><span class="n">withColumnSpec</span><span class="p">(</span><span class="s2">&quot;license_plate&quot;</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">n-</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="p">)</span>
           <span class="p">)</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">dataspec</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="n">df1</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="s2">&quot;overwrite&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">saveAsTable</span><span class="p">(</span><span class="s2">&quot;test_vehicle_data&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note the <code class="docutils literal notranslate"><span class="pre">template</span></code> parameter allows the generation of arbitrary text such as email addresses, VINs etc.</p>
<section id="adding-dataspecs-to-match-multiple-columns">
<h4>Adding dataspecs to match multiple columns<a class="headerlink" href="#adding-dataspecs-to-match-multiple-columns" title="Permalink to this heading"></a></h4>
<p>For large schemas, it can be unwieldy to specify column generation specs for every column in a schema.</p>
<p>To alleviate this , the framework provides mechanisms to add rules in bulk for multiple columns.</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">withColumnSpecs</span></code> method introduces a column generation specification for all columns matching a specific
naming pattern or datatype. You can override the column specification for a specific column using
the <code class="docutils literal notranslate"><span class="pre">withColumnSpec</span></code> method.</p></li>
</ul>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="p">(</span><span class="n">dg</span>
       <span class="o">.</span><span class="n">withColumnSpecs</span><span class="p">(</span><span class="n">patterns</span><span class="o">=</span><span class="s2">&quot;.*_ID&quot;</span><span class="p">,</span> <span class="n">matchTypes</span><span class="o">=</span><span class="n">StringType</span><span class="p">(),</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%010d</span><span class="s2">&quot;</span><span class="p">,</span> 
                               <span class="n">minValue</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">maxValue</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
       <span class="o">.</span><span class="n">withColumnSpecs</span><span class="p">(</span><span class="n">patterns</span><span class="o">=</span><span class="s2">&quot;.*_IDS&quot;</span><span class="p">,</span> <span class="n">matchTypes</span><span class="o">=</span><span class="n">StringType</span><span class="p">(),</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%010d</span><span class="s2">&quot;</span><span class="p">,</span> 
                               <span class="n">minValue</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxValue</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="a-more-complex-example-building-device-iot-test-data">
<h2>A more complex example - building Device IOT Test Data<a class="headerlink" href="#a-more-complex-example-building-device-iot-test-data" title="Permalink to this heading"></a></h2>
<p>This example shows generation of IOT device style data consisting of events from devices.</p>
<p>Here we want to generate a random set of events but ensure that the device properties remain the same for the
device from event to event.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">LongType</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">,</span> <span class="n">StringType</span>

<span class="kn">import</span> <span class="nn">dbldatagen</span> <span class="k">as</span> <span class="nn">dg</span>

<span class="n">shuffle_partitions_requested</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">device_population</span> <span class="o">=</span> <span class="mi">100000</span>
<span class="n">data_rows</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="mi">1000000</span>
<span class="n">partitions_requested</span> <span class="o">=</span> <span class="mi">20</span>

<span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;spark.sql.shuffle.partitions&quot;</span><span class="p">,</span> <span class="n">shuffle_partitions_requested</span><span class="p">)</span>

<span class="n">country_codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CN&#39;</span><span class="p">,</span> <span class="s1">&#39;US&#39;</span><span class="p">,</span> <span class="s1">&#39;FR&#39;</span><span class="p">,</span> <span class="s1">&#39;CA&#39;</span><span class="p">,</span> <span class="s1">&#39;IN&#39;</span><span class="p">,</span> <span class="s1">&#39;JM&#39;</span><span class="p">,</span> <span class="s1">&#39;IE&#39;</span><span class="p">,</span> <span class="s1">&#39;PK&#39;</span><span class="p">,</span> <span class="s1">&#39;GB&#39;</span><span class="p">,</span> <span class="s1">&#39;IL&#39;</span><span class="p">,</span> <span class="s1">&#39;AU&#39;</span><span class="p">,</span> <span class="s1">&#39;SG&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;ES&#39;</span><span class="p">,</span> <span class="s1">&#39;GE&#39;</span><span class="p">,</span> <span class="s1">&#39;MX&#39;</span><span class="p">,</span> <span class="s1">&#39;ET&#39;</span><span class="p">,</span> <span class="s1">&#39;SA&#39;</span><span class="p">,</span> <span class="s1">&#39;LB&#39;</span><span class="p">,</span> <span class="s1">&#39;NL&#39;</span><span class="p">]</span>
<span class="n">country_weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1300</span><span class="p">,</span> <span class="mi">365</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">1300</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">212</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">126</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span>
                   <span class="mi">17</span><span class="p">]</span>

<span class="n">manufacturers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Delta corp&#39;</span><span class="p">,</span> <span class="s1">&#39;Xyzzy Inc.&#39;</span><span class="p">,</span> <span class="s1">&#39;Lakehouse Ltd&#39;</span><span class="p">,</span> <span class="s1">&#39;Acme Corp&#39;</span><span class="p">,</span> <span class="s1">&#39;Embanks Devices&#39;</span><span class="p">]</span>

<span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;delta&#39;</span><span class="p">,</span> <span class="s1">&#39;xyzzy&#39;</span><span class="p">,</span> <span class="s1">&#39;lakehouse&#39;</span><span class="p">,</span> <span class="s1">&#39;gadget&#39;</span><span class="p">,</span> <span class="s1">&#39;droid&#39;</span><span class="p">]</span>

<span class="n">testDataSpec</span> <span class="o">=</span> <span class="p">(</span><span class="n">dg</span><span class="o">.</span><span class="n">DataGenerator</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;device_data_set&quot;</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">data_rows</span><span class="p">,</span>
                                 <span class="n">partitions</span><span class="o">=</span><span class="n">partitions_requested</span><span class="p">,</span> 
                                 <span class="n">randomSeedMethod</span><span class="o">=</span><span class="s1">&#39;hash_fieldname&#39;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">withIdOutput</span><span class="p">()</span>
                <span class="c1"># we&#39;ll use hash of the base field to generate the ids to </span>
                <span class="c1"># avoid a simple incrementing sequence</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;internal_device_id&quot;</span><span class="p">,</span> <span class="n">LongType</span><span class="p">(),</span> <span class="n">minValue</span><span class="o">=</span><span class="mh">0x1000000000000</span><span class="p">,</span>
                            <span class="n">uniqueValues</span><span class="o">=</span><span class="n">device_population</span><span class="p">,</span> <span class="n">omit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">baseColumnType</span><span class="o">=</span><span class="s2">&quot;hash&quot;</span><span class="p">)</span>

                <span class="c1"># note for format strings, we must use &quot;%lx&quot; not &quot;%x&quot; as the </span>
                <span class="c1"># underlying value is a long</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;device_id&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;0x</span><span class="si">%013x</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">baseColumn</span><span class="o">=</span><span class="s2">&quot;internal_device_id&quot;</span><span class="p">)</span>

                <span class="c1"># the device / user attributes will be the same for the same device id </span>
                <span class="c1"># so lets use the internal device id as the base column for these attribute</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="n">values</span><span class="o">=</span><span class="n">country_codes</span><span class="p">,</span>
                            <span class="n">weights</span><span class="o">=</span><span class="n">country_weights</span><span class="p">,</span>
                            <span class="n">baseColumn</span><span class="o">=</span><span class="s2">&quot;internal_device_id&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;manufacturer&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="n">values</span><span class="o">=</span><span class="n">manufacturers</span><span class="p">,</span>
                            <span class="n">baseColumn</span><span class="o">=</span><span class="s2">&quot;internal_device_id&quot;</span><span class="p">)</span>

                <span class="c1"># use omit = True if you don&#39;t want a column to appear in the final output </span>
                <span class="c1"># but just want to use it as part of generation of another column</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="n">values</span><span class="o">=</span><span class="n">lines</span><span class="p">,</span> <span class="n">baseColumn</span><span class="o">=</span><span class="s2">&quot;manufacturer&quot;</span><span class="p">,</span>
                            <span class="n">baseColumnType</span><span class="o">=</span><span class="s2">&quot;hash&quot;</span><span class="p">,</span> <span class="n">omit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;model_ser&quot;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="n">minValue</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxValue</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
                            <span class="n">baseColumn</span><span class="o">=</span><span class="s2">&quot;device_id&quot;</span><span class="p">,</span>
                            <span class="n">baseColumnType</span><span class="o">=</span><span class="s2">&quot;hash&quot;</span><span class="p">,</span> <span class="n">omit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;model_line&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;concat(line, &#39;#&#39;, model_ser)&quot;</span><span class="p">,</span>
                            <span class="n">baseColumn</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="s2">&quot;model_ser&quot;</span><span class="p">])</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span>
                            <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;activation&quot;</span><span class="p">,</span> <span class="s2">&quot;deactivation&quot;</span><span class="p">,</span> <span class="s2">&quot;plan change&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;telecoms activity&quot;</span><span class="p">,</span> <span class="s2">&quot;internet activity&quot;</span><span class="p">,</span> <span class="s2">&quot;device error&quot;</span><span class="p">],</span>
                            <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;event_ts&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="n">begin</span><span class="o">=</span><span class="s2">&quot;2020-01-01 01:00:00&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;2020-12-31 23:59:00&quot;</span><span class="p">,</span> 
                            <span class="n">interval</span><span class="o">=</span><span class="s2">&quot;1 minute&quot;</span><span class="p">,</span> <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="p">)</span>

<span class="n">dfTestData</span> <span class="o">=</span> <span class="n">testDataSpec</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="n">display</span><span class="p">(</span><span class="n">dfTestData</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">withColumn</span></code> method call for the <code class="docutils literal notranslate"><span class="pre">internalDeviceId</span></code> column uses the <code class="docutils literal notranslate"><span class="pre">uniqueValues</span></code> option to control the number
of unique values.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">withColumn</span></code> method call for the <code class="docutils literal notranslate"><span class="pre">manufacture</span></code> column uses the <code class="docutils literal notranslate"><span class="pre">baseColumn</span></code> option to ensure we get the same
manufacturer value for each <code class="docutils literal notranslate"><span class="pre">internalDeviceId</span></code>. This allows us to generate IOT style events at random, but still
constrain properties whenever the same <code class="docutils literal notranslate"><span class="pre">internalDeviceId</span></code> occurs.<br />of unique values.</p></li>
</ul>
<blockquote>
<div><p>A column may be based on one or more other columns. This means the value of that column will be used as a seed for
generating the new column. The <code class="docutils literal notranslate"><span class="pre">baseColumnType</span></code> option determines if the actual value , or hash of the value is
used as the seed value.</p>
</div></blockquote>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">withColumn</span></code> method call for the <code class="docutils literal notranslate"><span class="pre">line</span></code> column introduces a temporary column for purposes of
generating other columns, but through the use of the <code class="docutils literal notranslate"><span class="pre">omit</span></code> option, omits it from the final data set.</p></li>
</ul>
<section id="scaling-it-up">
<h3>Scaling it up<a class="headerlink" href="#scaling-it-up" title="Permalink to this heading"></a></h3>
<p>When generating data, the number of rows to be generated is controlled by the <code class="docutils literal notranslate"><span class="pre">rows</span></code> parameter supplied to the
creation of the data generator instance.</p>
<p>The number of Spark tasks to be used is controlled by the <code class="docutils literal notranslate"><span class="pre">partitions</span></code> parameter supplied to the
creation of the data generator instance.</p>
<p>As with any Spark process, the number of Spark tasks controls how many nodes are used to parallelize the activity, with
each Spark task being assigned to an executor running on an node.</p>
<p>By increasing the number of rows and number of Spark partitions, you can scale up generation to 100s of millions
or billions of rows.</p>
<p>For example, using the same code as before, but with different rows and partitions settings, you can generate a billion
rows of data and write it to a Delta table in under 2 minutes (with a 12 node x 8 core cluster)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">LongType</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">,</span> <span class="n">StringType</span>

<span class="kn">import</span> <span class="nn">dbldatagen</span> <span class="k">as</span> <span class="nn">dg</span>

<span class="n">shuffle_partitions_requested</span> <span class="o">=</span> <span class="mi">12</span> <span class="o">*</span> <span class="mi">4</span>
<span class="n">partitions_requested</span> <span class="o">=</span> <span class="mi">96</span>
<span class="n">device_population</span> <span class="o">=</span> <span class="mi">100000</span>
<span class="n">data_rows</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000000</span>

<span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;spark.sql.shuffle.partitions&quot;</span><span class="p">,</span> <span class="n">shuffle_partitions_requested</span><span class="p">)</span>

<span class="n">country_codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CN&#39;</span><span class="p">,</span> <span class="s1">&#39;US&#39;</span><span class="p">,</span> <span class="s1">&#39;FR&#39;</span><span class="p">,</span> <span class="s1">&#39;CA&#39;</span><span class="p">,</span> <span class="s1">&#39;IN&#39;</span><span class="p">,</span> <span class="s1">&#39;JM&#39;</span><span class="p">,</span> <span class="s1">&#39;IE&#39;</span><span class="p">,</span> <span class="s1">&#39;PK&#39;</span><span class="p">,</span> <span class="s1">&#39;GB&#39;</span><span class="p">,</span> <span class="s1">&#39;IL&#39;</span><span class="p">,</span> <span class="s1">&#39;AU&#39;</span><span class="p">,</span> <span class="s1">&#39;SG&#39;</span><span class="p">,</span> <span class="s1">&#39;ES&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;GE&#39;</span><span class="p">,</span> <span class="s1">&#39;MX&#39;</span><span class="p">,</span> <span class="s1">&#39;ET&#39;</span><span class="p">,</span> <span class="s1">&#39;SA&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;LB&#39;</span><span class="p">,</span> <span class="s1">&#39;NL&#39;</span><span class="p">]</span>
<span class="n">country_weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1300</span><span class="p">,</span> <span class="mi">365</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">1300</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">212</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">126</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span>
                   <span class="mi">17</span><span class="p">]</span>

<span class="n">manufacturers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Delta corp&#39;</span><span class="p">,</span> <span class="s1">&#39;Xyzzy Inc.&#39;</span><span class="p">,</span> <span class="s1">&#39;Lakehouse Ltd&#39;</span><span class="p">,</span> <span class="s1">&#39;Acme Corp&#39;</span><span class="p">,</span> <span class="s1">&#39;Embanks Devices&#39;</span><span class="p">]</span>

<span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;delta&#39;</span><span class="p">,</span> <span class="s1">&#39;xyzzy&#39;</span><span class="p">,</span> <span class="s1">&#39;lakehouse&#39;</span><span class="p">,</span> <span class="s1">&#39;gadget&#39;</span><span class="p">,</span> <span class="s1">&#39;droid&#39;</span><span class="p">]</span>

<span class="n">testDataSpec</span> <span class="o">=</span> <span class="p">(</span><span class="n">dg</span><span class="o">.</span><span class="n">DataGenerator</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;device_data_set&quot;</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">data_rows</span><span class="p">,</span>
                                 <span class="n">partitions</span><span class="o">=</span><span class="n">partitions_requested</span><span class="p">,</span> <span class="n">randomSeedMethod</span><span class="o">=</span><span class="s1">&#39;hash_fieldname&#39;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">withIdOutput</span><span class="p">()</span>
                <span class="c1"># we&#39;ll use hash of the base field to generate the ids to </span>
                <span class="c1"># avoid a simple incrementing sequence</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;internal_device_id&quot;</span><span class="p">,</span> <span class="n">LongType</span><span class="p">(),</span> <span class="n">minValue</span><span class="o">=</span><span class="mh">0x1000000000000</span><span class="p">,</span>
                            <span class="n">uniqueValues</span><span class="o">=</span><span class="n">device_population</span><span class="p">,</span> <span class="n">omit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">baseColumnType</span><span class="o">=</span><span class="s2">&quot;hash&quot;</span><span class="p">)</span>

                <span class="c1"># note for format strings, we must use &quot;%lx&quot; not &quot;%x&quot; as the </span>
                <span class="c1"># underlying value is a long</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;device_id&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;0x</span><span class="si">%013x</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">baseColumn</span><span class="o">=</span><span class="s2">&quot;internal_device_id&quot;</span><span class="p">)</span>

                <span class="c1"># the device / user attributes will be the same for the same device id </span>
                <span class="c1"># so lets use the internal device id as the base column for these attribute</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="n">values</span><span class="o">=</span><span class="n">country_codes</span><span class="p">,</span>
                            <span class="n">weights</span><span class="o">=</span><span class="n">country_weights</span><span class="p">,</span>
                            <span class="n">baseColumn</span><span class="o">=</span><span class="s2">&quot;internal_device_id&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;manufacturer&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="n">values</span><span class="o">=</span><span class="n">manufacturers</span><span class="p">,</span>
                            <span class="n">baseColumn</span><span class="o">=</span><span class="s2">&quot;internal_device_id&quot;</span><span class="p">)</span>

                <span class="c1"># use omit = True if you don&#39;t want a column to appear in the final output </span>
                <span class="c1"># but just want to use it as part of generation of another column</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="n">values</span><span class="o">=</span><span class="n">lines</span><span class="p">,</span> <span class="n">baseColumn</span><span class="o">=</span><span class="s2">&quot;manufacturer&quot;</span><span class="p">,</span>
                            <span class="n">baseColumnType</span><span class="o">=</span><span class="s2">&quot;hash&quot;</span><span class="p">,</span> <span class="n">omit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;model_ser&quot;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="n">minValue</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxValue</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
                            <span class="n">baseColumn</span><span class="o">=</span><span class="s2">&quot;device_id&quot;</span><span class="p">,</span>
                            <span class="n">baseColumnType</span><span class="o">=</span><span class="s2">&quot;hash&quot;</span><span class="p">,</span> <span class="n">omit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;model_line&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;concat(line, &#39;#&#39;, model_ser)&quot;</span><span class="p">,</span>
                            <span class="n">baseColumn</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="s2">&quot;model_ser&quot;</span><span class="p">])</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span>
                            <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;activation&quot;</span><span class="p">,</span> <span class="s2">&quot;deactivation&quot;</span><span class="p">,</span> <span class="s2">&quot;plan change&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;telecoms activity&quot;</span><span class="p">,</span> <span class="s2">&quot;internet activity&quot;</span><span class="p">,</span> <span class="s2">&quot;device error&quot;</span><span class="p">],</span>
                            <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;event_ts&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="n">begin</span><span class="o">=</span><span class="s2">&quot;2020-01-01 01:00:00&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;2020-12-31 23:59:00&quot;</span><span class="p">,</span>
                            <span class="n">interval</span><span class="o">=</span><span class="s2">&quot;1 minute&quot;</span><span class="p">,</span> <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="p">)</span>

<span class="n">dfTestData</span> <span class="o">=</span> <span class="n">testDataSpec</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="n">dfTestData</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="s2">&quot;overwrite&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
    <span class="s2">&quot;/tmp/dbldatagen_examples/a_billion_row_table&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="using-sql-in-data-generation">
<h2>Using SQL in data generation<a class="headerlink" href="#using-sql-in-data-generation" title="Permalink to this heading"></a></h2>
<p>Any column specification can use arbitrary SQL expressions during data generation via the <code class="docutils literal notranslate"><span class="pre">expr</span></code> parameter.</p>
<p>The following example shows generation of synthetic names, email addresses and
use of a SQL expression to compute MD5 hashes of hypothetical synthetic credit card :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dbldatagen</span> <span class="k">as</span> <span class="nn">dg</span>

<span class="n">shuffle_partitions_requested</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">partitions_requested</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">data_rows</span> <span class="o">=</span> <span class="mi">10000000</span>

<span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;spark.sql.shuffle.partitions&quot;</span><span class="p">,</span> <span class="n">shuffle_partitions_requested</span><span class="p">)</span>

<span class="n">dataspec</span> <span class="o">=</span> <span class="p">(</span><span class="n">dg</span><span class="o">.</span><span class="n">DataGenerator</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">data_rows</span><span class="p">,</span> <span class="n">partitions</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">randomSeedMethod</span><span class="o">=</span><span class="s2">&quot;hash_fieldname&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">percentNulls</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">w </span><span class="se">\\</span><span class="s1">w|</span><span class="se">\\</span><span class="s1">w a. </span><span class="se">\\</span><span class="s1">w&#39;</span><span class="p">)</span> 
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;payment_instrument_type&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;paypal&#39;</span><span class="p">,</span> <span class="s1">&#39;visa&#39;</span><span class="p">,</span> <span class="s1">&#39;mastercard&#39;</span><span class="p">,</span> <span class="s1">&#39;amex&#39;</span><span class="p">],</span> 
                            <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>             
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;int_payment_instrument&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span>  <span class="n">minValue</span><span class="o">=</span><span class="mi">0000</span><span class="p">,</span> <span class="n">maxValue</span><span class="o">=</span><span class="mi">9999</span><span class="p">,</span>  
                            <span class="n">baseColumn</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
                            <span class="n">baseColumnType</span><span class="o">=</span><span class="s2">&quot;hash&quot;</span><span class="p">,</span> <span class="n">omit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;payment_instrument&quot;</span><span class="p">,</span> 
                             <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;format_number(int_payment_instrument, &#39;**** ****** *####&#39;)&quot;</span><span class="p">,</span>
                             <span class="n">baseColumn</span><span class="o">=</span><span class="s2">&quot;int_payment_instrument&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">w.</span><span class="se">\\</span><span class="s1">w@</span><span class="se">\\</span><span class="s1">w.com&#39;</span><span class="p">)</span>       
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;md5_payment_instrument&quot;</span><span class="p">,</span> 
                            <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;md5(concat(payment_instrument_type, &#39;:&#39;, payment_instrument))&quot;</span><span class="p">,</span>
                            <span class="n">baseColumn</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;payment_instrument_type&#39;</span><span class="p">,</span> <span class="s1">&#39;payment_instrument&#39;</span><span class="p">])</span> 
           <span class="p">)</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">dataspec</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="n">df1</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
<p>See the section on <a class="reference internal" href="textdata.html"><span class="doc">text generation</span></a> for more details on these options.</p>
<section id="generating-repeatable-data">
<h3>Generating repeatable data<a class="headerlink" href="#generating-repeatable-data" title="Permalink to this heading"></a></h3>
<p>By default, data is generated by a series of pre-determined transformations on an implicit <code class="docutils literal notranslate"><span class="pre">id</span></code> column in the data set.
Specifying the <code class="docutils literal notranslate"><span class="pre">baseColumn</span></code> argument allows specifying a dependency on one or more other columns. Note that use of the
parameter <code class="docutils literal notranslate"><span class="pre">baseColumnType</span></code> will allow determining how the base column is used - for example you can specify that the
actual value, the hash of the value or an array of the values will be used as the starting point.</p>
<p>So generating data sets from the same data specification will result in the same data set every time unless random data
generation is deliberately chosen for a column.</p>
<p>If random data is desired, the generated data will be generated using a standard uniform random data generator unless a
specific <a class="reference internal" href="DISTRIBUTIONS.html"><span class="doc">distribution</span></a> is used.</p>
<p>However it is often desirable to generate random data that is repeatable - this is where the random seed is used.
By specifying a random seed value, you can ensure generation of random data but where random sequence repeats
across runs.</p>
<p>The following example generates repeatable data across runs:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dbldatagen</span> <span class="k">as</span> <span class="nn">dg</span>

<span class="n">shuffle_partitions_requested</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">partitions_requested</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">data_rows</span> <span class="o">=</span> <span class="mi">10000000</span>

<span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;spark.sql.shuffle.partitions&quot;</span><span class="p">,</span> <span class="n">shuffle_partitions_requested</span><span class="p">)</span>

<span class="n">dataspec</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">dg</span><span class="o">.</span><span class="n">DataGenerator</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">data_rows</span><span class="p">,</span> <span class="n">partitions</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">randomSeedMethod</span><span class="o">=</span><span class="s2">&quot;hash_fieldname&quot;</span><span class="p">,</span> 
                     <span class="n">randomSeed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">percentNulls</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">w </span><span class="se">\\</span><span class="s1">w|</span><span class="se">\\</span><span class="s1">w a. </span><span class="se">\\</span><span class="s1">w&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;payment_instrument_type&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;paypal&#39;</span><span class="p">,</span> <span class="s1">&#39;visa&#39;</span><span class="p">,</span> <span class="s1">&#39;mastercard&#39;</span><span class="p">,</span> <span class="s1">&#39;amex&#39;</span><span class="p">],</span>
                <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;int_payment_instrument&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span>  <span class="n">minValue</span><span class="o">=</span><span class="mi">0000</span><span class="p">,</span> <span class="n">maxValue</span><span class="o">=</span><span class="mi">9999</span><span class="p">,</span>  
                <span class="n">baseColumn</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
                <span class="n">baseColumnType</span><span class="o">=</span><span class="s2">&quot;hash&quot;</span><span class="p">,</span> <span class="n">omit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;payment_instrument&quot;</span><span class="p">,</span> 
                <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;format_number(int_payment_instrument, &#39;**** ****** *####&#39;)&quot;</span><span class="p">,</span>
                <span class="n">baseColumn</span><span class="o">=</span><span class="s2">&quot;int_payment_instrument&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">w.</span><span class="se">\\</span><span class="s1">w@</span><span class="se">\\</span><span class="s1">w.com&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;md5_payment_instrument&quot;</span><span class="p">,</span>
                <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;md5(concat(payment_instrument_type, &#39;:&#39;, payment_instrument))&quot;</span><span class="p">,</span>
                <span class="n">baseColumn</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;payment_instrument_type&#39;</span><span class="p">,</span> <span class="s1">&#39;payment_instrument&#39;</span><span class="p">])</span>
    <span class="p">)</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">dataspec</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="n">df1</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
<p>These options allows for generating multiple tables and ensuring referential
integrity across primary and foreign keys.</p>
</section>
</section>
<section id="using-generated-data-from-sql">
<h2>Using generated data from SQL<a class="headerlink" href="#using-generated-data-from-sql" title="Permalink to this heading"></a></h2>
<p>By defining a view over the generated data, you can use the generated data from SQL.</p>
<p>To simply this process, you can use options to the <code class="docutils literal notranslate"><span class="pre">build</span></code> method to generate temporary or global views over the data.</p>
<p>At the time of writing, the specification for generation of data needs to be authored in Python.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Databricks Labs Data Generator documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="installation_notes.html" class="btn btn-neutral float-right" title="Installation notes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022,2023 Databricks Inc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>